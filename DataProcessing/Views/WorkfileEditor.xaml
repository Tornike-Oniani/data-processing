<UserControl x:Class="DataProcessing.Views.WorkfileEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:DataProcessing.Views"
             xmlns:utils="clr-namespace:DataProcessing.Utils"
            xmlns:converters="clr-namespace:DataProcessing.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    <UserControl.Resources>
        <converters:TimeSpanToStringConverter x:Key="TimeSpanToString" />
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <!-- Menu row -->
            <RowDefinition Height="Auto" />
            <!-- Content row -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!-- Menu -->
        <Menu Grid.Row="0">
            <MenuItem Header="_File">
                <!--<MenuItem Header="_New" Command="{Binding NewWorkfileDialogCommand}" />
                <MenuItem Header="_Open" Command="{Binding OpenWorkfileDialogCommand}" />-->
                <MenuItem Header="_Export" Command="{Binding ExportCommand}" />
                <MenuItem Header="_Calculate" Command="{Binding CalculateCommand}" />
                <!--<MenuItem Header="_Test" Command="{Binding TestCommand}" />-->
            </MenuItem>
        </Menu>
        <!-- Content -->
        <Border Padding="10" Grid.Row="1">
            <Grid>
                <Grid.RowDefinitions>
                    <!-- Entry column -->
                    <RowDefinition Height="Auto" />
                    <!-- Display column -->
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Entry -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <!-- Add text column -->
                        <ColumnDefinition Width="125" />
                        <!-- Add button column -->
                        <ColumnDefinition Width="Auto" />
                        <!-- Edit text column-->
                        <ColumnDefinition Width="125" />
                        <!-- Edit button column-->
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Add text -->
                    <TextBox Text="{Binding EntryManager.TimeStamp, UpdateSourceTrigger=PropertyChanged}" 
                         utils:FocusExtension.IsFocused="{Binding EntryManager.IsEntryFocused}"
                         Grid.Column="0"
                         PreviewTextInput="TextBox_PreviewTextInput">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding EntryManager.AddCommand}" />
                        </TextBox.InputBindings>
                    </TextBox>

                    <!-- Add button -->
                    <Button Content="Add" 
                        Command="{Binding EntryManager.AddCommand}"
                        Style="{StaticResource MainButtonStyle}"
                        Width="70" 
                        Margin="10 0 10 0" 
                        Grid.Column="1" />

                    <!-- Edit text -->
                    <TextBox x:Name="txbEdit"
                         Text="{Binding DisplayManager.SelectedRow.AT, UpdateSourceTrigger=Explicit, Converter={StaticResource TimeSpanToString}}" 
                         utils:FocusExtension.IsFocused="{Binding EntryManager.IsEntryFocused}"
                         Margin="0 0 10 0" 
                         Grid.Column="2"
                         PreviewTextInput="TextBox_TimeSpanInput">
                    </TextBox>

                    <!-- Edit button -->
                    <Button Content="Edit"
                        Command="{Binding EditCommand}"
                        CommandParameter="{Binding ElementName=txbEdit, Path=Text}"
                        Style="{StaticResource MainButtonStyle}"
                        Width="70" 
                        Grid.Column="3" />
                </Grid>

                <!-- Display -->
                <DataGrid x:Name="myDataGrid" ItemsSource="{Binding DisplayManager.Items}"
                      SelectedItem="{Binding DisplayManager.SelectedRow}"
                      Style="{StaticResource MainDataGrid}"
                      Margin="0 10 0 0" 
                      Grid.Row="1"
                      MouseUp="DataGrid_MouseUp">

                    <!-- Columns -->
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="A" MinWidth="95" Binding="{Binding AT}" />
                        <DataGridTextColumn Header="B" MinWidth="95" Binding="{Binding BT}" />
                        <DataGridTextColumn Header="C" MinWidth="95" Binding="{Binding C}" />
                        <DataGridTextColumn Header="D" MinWidth="95" Binding="{Binding D}" />
                        <DataGridTextColumn Header="State" MinWidth="95" Binding="{Binding State}" />
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
